package com.busreservation.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.time.LocalDateTime;

import com.busreservation.dto.BusInfo;
import com.busreservation.dto.Customer;
import com.busreservation.exception.BookingFail;
import com.busreservation.exception.WrongCredentials;

public class BusBookingDaoImpl implements BusBookingDao {

	@Override
	public boolean bookTicket(Customer customer, BusInfo busInfo) throws BookingFail {
		Connection connection = null;
		
		try {
			
			connection = DBUtils.createConnection();
			
			String insert_query = "Insert into busbooking (customerId,busNumber,DateOfBooking,Total_tickets,Total_fare) values (? , ? , ? , ? , ?)";
			
			PreparedStatement statement = connection.prepareStatement(insert_query);
			
			statement.setInt(1,email);
			statement.setInt(2,email);
			statement.setString(3,password);
			statement.setDate(4,LocalDateTime.now());
			statement.setString(5,password);

			int result = statement.executeUpdate();
			
			if(result > 0) {
			   	throw new WrongCredentials("Login Fail! Please Enter Valid Credentials");
			}
			
		} catch (SQLException e) {
			
			e.printStackTrace();
			
		}finally {
			
			try {
				DBUtils.closeConnection(connection);
			} catch (SQLException e) {
				e.printStackTrace();
			}
			
		}
		
		return true;
	}

}
